<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />

        <title>Buckaroo Direct Manipulation Visual Data Cleaning Tool</title>

        <link rel="icon" type="image/png" href="{{ url_for('static',filename='images/favicon/favicon-96x96.png')}}" sizes="96x96" />
        <link rel="icon" type="image/svg+xml" href="{{ url_for('static',filename='images/favicon/favicon.svg')}}" />
        <link rel="shortcut icon" href="{{ url_for('static',filename='images/favicon/favicon.ico')}}" />
        <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static',filename='images/favicon/apple-touch-icon.png')}}" />
        <link rel="manifest" href="{{ url_for('static',filename='images/favicon/site.webmanifest')}}" />

        <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles.css')}}" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

        <script>
            // function loadDataset(filename) {
            //     localStorage.setItem("userUploaded","no");
            //     localStorage.setItem("selectedSample",filename);
            //     window.location.href = "{{ url_for('data_cleaning_vis_tool') }}";
            // }

            async function loadDataset(dataset) {
                // const uploadedFile = document.getElementById("fileInput").files[0];
                // const fileToSend = new FormData();
                // console.log("starting upload", uploadedFile);
                // fileToSend.append("file",uploadedFile);
                // document.getElementById('spinnerModal').style.display = 'block';
                const url = "/api/sample-dataset?ds=" + encodeURIComponent(dataset);
                try {
                    const response = await fetch(url, {
                        method: "GET",
                        // body: fileToSend
                    });
                    if (!response.ok) {
                        throw new Error(`Response status: ${response.status}`);
                    }
                    if (response.statusText === "OK") {
                        /** Add a way to tell the user that the csv was uploaded successfully*/
                        localStorage.setItem("userUploaded", "yes");
                        localStorage.setItem("selectedSample", dataset)
                        window.location.href = "{{ url_for('data_cleaning_vis_tool') }}";
                    }
                } catch (error) {
                    console.error(error.message);
                }
            }            

            async function fileUpload() {
                const uploadedFile = document.getElementById("fileInput").files[0];
                const fileToSend = new FormData();
                console.log("starting upload", uploadedFile);
                fileToSend.append("file",uploadedFile);
                document.getElementById('spinnerModal').style.display = 'block';
                const url = "/api/upload"
                try {
                    const response = await fetch(url, {
                        method: "POST",
                        body: fileToSend
                    });
                    if (!response.ok) {
                        throw new Error(`Response status: ${response.status}`);
                    }
                    if (response.statusText === "OK") {
                        /** Add a way to tell the user that the csv was uploaded successfully*/
                        localStorage.setItem("userUploaded", "yes");
                        localStorage.setItem("selectedSample", uploadedFile['name'])
                        window.location.href = "{{ url_for('data_cleaning_vis_tool') }}";
                    }
                } catch (error) {
                    console.error(error.message);
                }
            }
        </script>

    </head>

    <body>

        <div id="spinnerModal" class="modal">
            <div class="modal-content">
                <div class="loader"></div>
                <p>Uploading, please wait...</p>
            </div>
        </div>    

        <div id="header">
            <h1>Buckaroo Visual Wrangler ðŸ¤ </h1>
        </div>

        <div id="placeholder-message" style="text-align: center; margin-top: 200px; font-size: 40px; color: darkslategrey;">
            <div>Welcome to Buckaroo!</div>
            <div style="font-size: 24px; margin-top: 10px; color: gray;">
                Start by selecting a dataset or uploading your own:
                <br><br>
                <div class="dataset-button" onclick="loadDataset('/static/datasets/stackoverflow_db_uncleaned.csv')">StackOverflow Survey</div>
                <div class="dataset-button" onclick="loadDataset('/static/datasets/Crimes_-_One_year_prior_to_present_20250421.csv')"> Chicago Crime</div>
                <div class="dataset-button" onclick="loadDataset('/static/datasets/complaints-2025-04-21_17_31.csv')"> Student Loan Complaints</div>
                <div class="dataset-button" onclick="document.getElementById('fileInput').click();">Upload Your Own File</div>
                <input type="file" id="fileInput" accept=".csv" oninput="fileUpload()" style="display: none;"/>
            </div>
        </div>

    </body>
</html>
